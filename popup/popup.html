<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Proofreader</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><svg width="20" height="20" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 8px;">
              <circle cx="16" cy="16" r="15" fill="#4CAF50"/>
              <text x="16" y="20" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">AI</text>
              <circle cx="8" cy="8" r="1.5" fill="white" opacity="0.8"/>
              <circle cx="24" cy="8" r="1.5" fill="white" opacity="0.8"/>
              <circle cx="8" cy="24" r="1.5" fill="white" opacity="0.8"/>
              <circle cx="24" cy="24" r="1.5" fill="white" opacity="0.8"/>
            </svg>AI Text Proofreader</h1>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="proofread">Proofread</button>
            <button class="tab-button" data-tab="context">Context</button>
            <button class="tab-button" data-tab="settings">Settings</button>
        </div>

        <!-- Proofread Tab -->
        <div id="proofread-tab" class="tab-content active">
            <div class="section">
                <label for="input-text">Enter text to proofread:</label>
                <textarea id="input-text" placeholder="Paste or type your text here..." rows="6"></textarea>
            </div>

            <div class="button-group">
                <button id="proofread-btn" class="primary-btn" title="Proofread Text">
                    <svg width="16" height="16" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="16" cy="16" r="15" fill="currentColor"/>
                      <text x="16" y="20" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">AI</text>
                      <circle cx="8" cy="8" r="1.5" fill="white" opacity="0.8"/>
                      <circle cx="24" cy="8" r="1.5" fill="white" opacity="0.8"/>
                      <circle cx="8" cy="24" r="1.5" fill="white" opacity="0.8"/>
                      <circle cx="24" cy="24" r="1.5" fill="white" opacity="0.8"/>
                    </svg>
                </button>
                <button id="suggestions-btn" class="secondary-btn" title="Get Suggestions">üí°</button>
            </div>

            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <span>Processing with AI...</span>
            </div>

            <div id="result-section" class="section hidden">
                <label>Result:</label>
                <textarea id="output-text" rows="6" readonly></textarea>
                <div class="button-group">
                    <button id="copy-result" class="secondary-btn" title="Copy Result">üìã</button>
                    <button id="accept-changes" class="primary-btn" title="Accept Changes">‚úÖ</button>
                </div>
            </div>

            <div id="suggestions-section" class="section hidden">
                <label>Suggestions:</label>
                <div id="suggestions-list" class="suggestions-container"></div>
            </div>
        </div>

        <!-- Context Tab -->
        <div id="context-tab" class="tab-content">
            <div class="section">
                <h3>üåê Website Categories</h3>
                <p>Configure which websites belong to each category:</p>
                
                <div class="category-section">
                    <h4>üìß Email Applications</h4>
                    <div class="website-list" id="email-websites">
                        <!-- Dynamic content -->
                    </div>
                    <div class="add-website">
                        <input type="text" id="new-email-website" placeholder="e.g., mail.yahoo.com, protonmail.com">
                        <button id="add-email-website" class="secondary-btn" title="Add Email Website">+</button>
                    </div>
                </div>

                <div class="category-section">
                    <h4>üíª Development Platforms</h4>
                    <div class="website-list" id="dev-websites">
                        <!-- Dynamic content -->
                    </div>
                    <div class="add-website">
                        <input type="text" id="new-dev-website" placeholder="e.g., bitbucket.org, dev.azure.com">
                        <button id="add-dev-website" class="secondary-btn" title="Add Development Website">+</button>
                    </div>
                </div>

                <div class="category-section">
                    <h4>üì± Social Media</h4>
                    <div class="website-list" id="social-websites">
                        <!-- Dynamic content -->
                    </div>
                    <div class="add-website">
                        <input type="text" id="new-social-website" placeholder="e.g., instagram.com, tiktok.com">
                        <button id="add-social-website" class="secondary-btn" title="Add Social Website">+</button>
                    </div>
                </div>

                <div class="category-section">
                    <h4>üìù Documentation</h4>
                    <div class="website-list" id="docs-websites">
                        <!-- Dynamic content -->
                    </div>
                    <div class="add-website">
                        <input type="text" id="new-docs-website" placeholder="e.g., atlassian.net, gitbook.io">
                        <button id="add-docs-website" class="secondary-btn" title="Add Documentation Website">+</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>‚úèÔ∏è Custom Prompts</h3>
                <p>Edit prompts for each category:</p>
                
                <div class="prompt-editor">
                    <label for="category-select">Select Category:</label>
                    <select id="category-select">
                        <option value="email">üìß Email</option>
                        <option value="development">üíª Development</option>
                        <option value="social">üì± Social Media</option>
                        <option value="documentation">üìù Documentation</option>
                        <option value="general">üåê General</option>
                    </select>
                </div>

                <div class="prompt-editor">
                    <label for="tone-select">Tone/Mode:</label>
                    <select id="tone-select">
                        <option value="default">Default</option>
                        <option value="formal">Formal</option>
                        <option value="casual">Casual</option>
                    </select>
                </div>

                <div class="prompt-editor">
                    <label for="prompt-text">Prompt Template:</label>
                    <textarea id="prompt-text" rows="8" placeholder="Enter your custom prompt here. Use {{TEXT}} where the user's text should be inserted."></textarea>
                    <small>Use <code>{{TEXT}}</code> as a placeholder for the user's input text.</small>
                </div>

                <div class="button-group">
                    <button id="save-prompt" class="primary-btn" title="Save Prompt">üíæ</button>
                    <button id="reset-prompt" class="secondary-btn" title="Reset to Default">üîÑ</button>
                    <button id="preview-prompt" class="secondary-btn" title="Preview">üëÅÔ∏è</button>
                </div>

                <div id="prompt-preview" class="section hidden">
                    <label>Preview (with sample text):</label>
                    <div class="preview-container">
                        <pre id="preview-text"></pre>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button id="save-context-settings" class="primary-btn" title="Save All Context Settings">üíæ</button>
                <button id="reset-context-settings" class="secondary-btn" title="Reset All">üîÑ</button>
                <button id="export-settings" class="secondary-btn" title="Export Settings">üì§</button>
                <button id="import-settings" class="secondary-btn" title="Import Settings">üì•</button>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="section">
                <label for="provider-select">LLM Provider:</label>
                <select id="provider-select">
                    <optgroup label="Local/Self-Hosted">
                        <option value="local">Local LLM (Ollama)</option>
                        <option value="llamacpp">llama.cpp Server</option>
                        <option value="textgen">Text Generation WebUI</option>
                        <option value="koboldcpp">KoboldCpp</option>
                        <option value="tabbyapi">TabbyAPI</option>
                    </optgroup>
                    <optgroup label="Commercial APIs">
                        <option value="openai">OpenAI (GPT-4, GPT-3.5)</option>
                        <option value="anthropic">Anthropic (Claude)</option>
                        <option value="google">Google (Gemini/Bard)</option>
                        <option value="cohere">Cohere</option>
                        <option value="mistral">Mistral AI</option>
                        <option value="groq">Groq</option>
                        <option value="together">Together AI</option>
                        <option value="replicate">Replicate</option>
                        <option value="huggingface">Hugging Face Inference</option>
                    </optgroup>
                    <optgroup label="Open Source APIs">
                        <option value="perplexity">Perplexity AI</option>
                        <option value="deepseek">DeepSeek</option>
                        <option value="fireworks">Fireworks AI</option>
                        <option value="anyscale">Anyscale</option>
                        <option value="deepinfra">DeepInfra</option>
                    </optgroup>
                    <optgroup label="Custom">
                        <option value="custom">Custom Endpoint</option>
                        <option value="openrouter">OpenRouter</option>
                    </optgroup>
                </select>
            </div>

            <div class="section">
                <label for="model-input">Model Name:</label>
                <input type="text" id="model-input" placeholder="e.g., llama2, gpt-3.5-turbo">
                <small>For local: ollama model name. For OpenAI: model ID</small>
            </div>

            <div id="openai-settings" class="section hidden">
                <label for="api-key-input">OpenAI API Key:</label>
                <input type="password" id="api-key-input" placeholder="sk-...">
                <small>Your API key is stored locally and never shared</small>
            </div>

            <div id="custom-settings" class="section hidden">
                <label for="custom-endpoint-input">Custom Endpoint URL:</label>
                <input type="url" id="custom-endpoint-input" placeholder="https://your-llm-api.com/generate">
                <small>Custom LLM API endpoint</small>
            </div>

            <div class="section">
                <h3>Local LLM Setup (Ollama)</h3>
                <p>To use local LLMs:</p>
                <ol>
                    <li>Install <a href="https://ollama.ai" target="_blank">Ollama</a></li>
                    <li>Run: <code>ollama pull llama2</code></li>
                    <li>Set CORS: <code>$env:OLLAMA_ORIGINS="*"</code> (Windows)</li>
                    <li>Start: <code>ollama serve</code></li>
                </ol>
                <p><strong>Note:</strong> The CORS environment variable is required for browser extensions.</p>
                <button id="test-connection" class="secondary-btn" title="Test Connection">üîó</button>
            </div>

            <div class="button-group">
                <button id="save-settings" class="primary-btn" title="Save Settings">üíæ</button>
                <button id="reset-settings" class="secondary-btn" title="Reset">üîÑ</button>
            </div>

            <div class="section">
                <h3>Debug Tools</h3>
                <button id="show-debug" class="secondary-btn" title="Show Debug Info">üêõ</button>
                <div id="debug-info" class="debug-container hidden">
                    <textarea id="debug-output" rows="6" readonly placeholder="Debug information will appear here..."></textarea>
                    <button id="copy-debug" class="secondary-btn" title="Copy Debug Info">üìã</button>
                </div>
            </div>

            <div id="connection-status" class="status hidden"></div>
        </div>

        <footer>
            <p>Select text on any webpage and right-click for AI proofreading</p>
        </footer>
    </div>

    <script src="popup.js"></script>
</body>
</html>
