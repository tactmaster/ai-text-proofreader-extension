<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Proofreader</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><svg width="24" height="24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 8px;">
              <defs>
                <linearGradient id="headerAiGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#667eea"/>
                  <stop offset="50%" style="stop-color:#764ba2"/>
                  <stop offset="100%" style="stop-color:#f093fb"/>
                </linearGradient>
                <linearGradient id="headerCircuitGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#00d4aa"/>
                  <stop offset="100%" style="stop-color:#00a8ff"/>
                </linearGradient>
              </defs>
              <circle cx="16" cy="16" r="15" fill="url(#headerAiGrad)" stroke="white" stroke-width="1"/>
              <g opacity="0.4">
                <rect x="8" y="8" width="16" height="1" fill="url(#headerCircuitGrad)" rx="0.5"/>
                <rect x="8" y="11" width="12" height="1" fill="url(#headerCircuitGrad)" rx="0.5"/>
                <rect x="8" y="14" width="16" height="1" fill="url(#headerCircuitGrad)" rx="0.5"/>
                <rect x="8" y="17" width="10" height="1" fill="url(#headerCircuitGrad)" rx="0.5"/>
                <rect x="8" y="20" width="14" height="1" fill="url(#headerCircuitGrad)" rx="0.5"/>
                <rect x="8" y="23" width="8" height="1" fill="url(#headerCircuitGrad)" rx="0.5"/>
                <rect x="12" y="8" width="1" height="15" fill="url(#headerCircuitGrad)" rx="0.5"/>
                <rect x="20" y="8" width="1" height="12" fill="url(#headerCircuitGrad)" rx="0.5"/>
                <rect x="16" y="11" width="1" height="9" fill="url(#headerCircuitGrad)" rx="0.5"/>
              </g>
              <text x="16" y="20" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white" stroke="rgba(0,0,0,0.3)" stroke-width="0.5">AI</text>
              <circle cx="10" cy="10" r="1.5" fill="white" opacity="0.8"/>
              <circle cx="22" cy="10" r="1.5" fill="white" opacity="0.8"/>
              <circle cx="16" cy="6" r="1.5" fill="white" opacity="0.8"/>
              <circle cx="10" cy="26" r="1.5" fill="white" opacity="0.8"/>
              <circle cx="22" cy="26" r="1.5" fill="white" opacity="0.8"/>
              <line x1="10" y1="10" x2="16" y2="6" stroke="white" stroke-width="0.5" opacity="0.6"/>
              <line x1="22" y1="10" x2="16" y2="6" stroke="white" stroke-width="0.5" opacity="0.6"/>
              <line x1="10" y1="10" x2="10" y2="26" stroke="white" stroke-width="0.5" opacity="0.6"/>
              <line x1="22" y1="10" x2="22" y2="26" stroke="white" stroke-width="0.5" opacity="0.6"/>
            </svg>AI Text Proofreader</h1>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="proofread">Proofread</button>
            <button class="tab-button" data-tab="context">Context</button>
            <button class="tab-button" data-tab="privacy">Privacy</button>
            <button class="tab-button" data-tab="settings">Settings</button>
        </div>

        <!-- Proofread Tab -->
        <div id="proofread-tab" class="tab-content active">
            <div class="section">
                <label for="input-text">Enter text to proofread:</label>
                <textarea id="input-text" placeholder="Paste or type your text here..." rows="6"></textarea>
            </div>

            <div class="button-group">
                <button id="proofread-btn" class="primary-btn" title="Proofread Text">
                    ‚ú® Proofread
                </button>
                <button id="suggestions-btn" class="secondary-btn" title="Get Suggestions">üí° Suggestions</button>
            </div>

            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <span>Processing with AI...</span>
            </div>

            <div id="result-section" class="section hidden">
                <label>Result:</label>
                <textarea id="output-text" rows="6" readonly></textarea>
                <div class="button-group">
                    <button id="copy-result" class="secondary-btn" title="Copy Result">üìã Copy</button>
                    <button id="accept-changes" class="primary-btn" title="Accept Changes">‚úÖ Accept</button>
                </div>
            </div>

            <div id="suggestions-section" class="section hidden">
                <label>Suggestions:</label>
                <div id="suggestions-list" class="suggestions-container"></div>
            </div>
        </div>

        <!-- Context Tab -->
        <div id="context-tab" class="tab-content">
            <div class="section">
                <h3>üåê Website Categories</h3>
                <p>Configure which websites belong to each category:</p>
                
                <div class="category-section">
                    <h4>üìß Email Applications</h4>
                    <div class="website-list" id="email-websites">
                        <!-- Dynamic content -->
                    </div>
                    <div class="add-website">
                        <input type="text" id="new-email-website" placeholder="e.g., mail.yahoo.com, protonmail.com">
                        <button id="add-email-website" class="secondary-btn" title="Add Email Website">+</button>
                    </div>
                </div>

                <div class="category-section">
                    <h4>üíª Development Platforms</h4>
                    <div class="website-list" id="dev-websites">
                        <!-- Dynamic content -->
                    </div>
                    <div class="add-website">
                        <input type="text" id="new-dev-website" placeholder="e.g., bitbucket.org, dev.azure.com">
                        <button id="add-dev-website" class="secondary-btn" title="Add Development Website">+</button>
                    </div>
                </div>

                <div class="category-section">
                    <h4>üì± Social Media</h4>
                    <div class="website-list" id="social-websites">
                        <!-- Dynamic content -->
                    </div>
                    <div class="add-website">
                        <input type="text" id="new-social-website" placeholder="e.g., instagram.com, tiktok.com">
                        <button id="add-social-website" class="secondary-btn" title="Add Social Website">+</button>
                    </div>
                </div>

                <div class="category-section">
                    <h4>üìù Documentation</h4>
                    <div class="website-list" id="docs-websites">
                        <!-- Dynamic content -->
                    </div>
                    <div class="add-website">
                        <input type="text" id="new-docs-website" placeholder="e.g., atlassian.net, gitbook.io">
                        <button id="add-docs-website" class="secondary-btn" title="Add Documentation Website">+</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>‚úèÔ∏è Custom Prompts</h3>
                <p>Edit prompts for each category:</p>
                
                <div class="prompt-editor">
                    <label for="category-select">Select Category:</label>
                    <select id="category-select">
                        <option value="email">üìß Email</option>
                        <option value="development">üíª Development</option>
                        <option value="social">üì± Social Media</option>
                        <option value="documentation">üìù Documentation</option>
                        <option value="general">üåê General</option>
                    </select>
                </div>

                <div class="prompt-editor">
                    <label for="tone-select">Tone/Mode:</label>
                    <select id="tone-select">
                        <option value="default">Default</option>
                        <option value="formal">Formal</option>
                        <option value="casual">Casual</option>
                    </select>
                </div>

                <div class="prompt-editor">
                    <label for="prompt-text">Prompt Template:</label>
                    <textarea id="prompt-text" rows="8" placeholder="Enter your custom prompt here. Use {{TEXT}} where the user's text should be inserted."></textarea>
                    <small>Use <code>{{TEXT}}</code> as a placeholder for the user's input text.</small>
                </div>

                <div class="button-group">
                    <button id="save-prompt" class="primary-btn" title="Save Prompt">üíæ Save</button>
                    <button id="reset-prompt" class="secondary-btn" title="Reset to Default">üîÑ Reset</button>
                    <button id="preview-prompt" class="secondary-btn" title="Preview">üëÅÔ∏è Preview</button>
                </div>

                <div id="prompt-preview" class="section hidden">
                    <label>Preview (with sample text):</label>
                    <div class="preview-container">
                        <pre id="preview-text"></pre>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button id="save-context-settings" class="primary-btn" title="Save All Context Settings">üíæ Save All</button>
                <button id="reset-context-settings" class="secondary-btn" title="Reset All">üîÑ Reset All</button>
                <button id="export-settings" class="secondary-btn" title="Export Settings">üì§ Export</button>
                <button id="import-settings" class="secondary-btn" title="Import Settings">üì• Import</button>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="section">
                <label for="provider-select">LLM Provider:</label>
                <select id="provider-select">
                    <optgroup label="Local/Self-Hosted">
                        <option value="local">Local LLM (Ollama)</option>
                        <option value="llamacpp">llama.cpp Server</option>
                        <option value="textgen">Text Generation WebUI</option>
                        <option value="koboldcpp">KoboldCpp</option>
                        <option value="tabbyapi">TabbyAPI</option>
                    </optgroup>
                    <optgroup label="Commercial APIs">
                        <option value="openai">OpenAI (GPT-4, GPT-3.5)</option>
                        <option value="anthropic">Anthropic (Claude)</option>
                        <option value="google">Google (Gemini/Bard)</option>
                        <option value="cohere">Cohere</option>
                        <option value="mistral">Mistral AI</option>
                        <option value="groq">Groq</option>
                        <option value="together">Together AI</option>
                        <option value="replicate">Replicate</option>
                        <option value="huggingface">Hugging Face Inference</option>
                    </optgroup>
                    <optgroup label="Open Source APIs">
                        <option value="perplexity">Perplexity AI</option>
                        <option value="deepseek">DeepSeek</option>
                        <option value="fireworks">Fireworks AI</option>
                        <option value="anyscale">Anyscale</option>
                        <option value="deepinfra">DeepInfra</option>
                    </optgroup>
                    <optgroup label="Custom">
                        <option value="custom">Custom Endpoint</option>
                        <option value="openrouter">OpenRouter</option>
                    </optgroup>
                </select>
            </div>

            <div class="section">
                <label for="model-input">Model Name:</label>
                <input type="text" id="model-input" placeholder="e.g., llama2, gpt-3.5-turbo">
                <small>For local: ollama model name. For OpenAI: model ID</small>
            </div>

            <div id="openai-settings" class="section hidden">
                <!-- OpenAI Connection Status -->
                <div id="openai-connection-status" class="connection-status">
                    <div id="openai-disconnected" class="status-card">
                        <div class="status-icon">üîë</div>
                        <div class="status-content">
                            <h4>Connect to OpenAI</h4>
                            <p>Get started with ChatGPT and GPT-4 models</p>
                            <div class="button-group">
                                <button id="openai-guided-setup-btn" class="primary-btn">
                                    üöÄ Connect with OpenAI
                                </button>
                                <button id="openai-manual-setup-btn" class="secondary-btn">
                                    ‚öôÔ∏è Manual Setup
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="openai-connected" class="status-card connected hidden">
                        <div class="status-icon">‚úÖ</div>
                        <div class="status-content">
                            <h4>Connected to OpenAI</h4>
                            <p id="openai-account-info">API key configured</p>
                            <div class="button-group">
                                <button id="openai-refresh-models-btn" class="secondary-btn">
                                    üîÑ Refresh Models
                                </button>
                                <button id="openai-disconnect-btn" class="secondary-btn">
                                    üîå Disconnect
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual API Key Setup (hidden by default) -->
                <div id="openai-manual-settings" class="hidden">
                    <label for="api-key-input">OpenAI API Key:</label>
                    <div class="input-group">
                        <input type="password" id="api-key-input" placeholder="sk-proj-...">
                        <button id="api-key-validate-btn" class="secondary-btn" title="Validate API Key">
                            ‚úì Validate
                        </button>
                    </div>
                    <small>Your API key is stored locally and never shared</small>
                    
                    <div id="api-key-validation" class="validation-result hidden">
                        <div id="validation-status"></div>
                        <div id="available-models" class="hidden">
                            <label>Available Models:</label>
                            <div id="models-list" class="models-grid"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="custom-settings" class="section hidden">
                <label for="custom-endpoint-input">Custom Endpoint URL:</label>
                <input type="url" id="custom-endpoint-input" placeholder="https://your-llm-api.com/generate">
                <small>Custom LLM API endpoint</small>
            </div>

            <div id="local-settings" class="section hidden">
                <label for="ollama-port-input">Ollama Port:</label>
                <input type="number" id="ollama-port-input" placeholder="11434" min="1" max="65535">
                <small>Port where Ollama server is running (default: 11434)</small>
                
                <div class="button-group">
                    <button id="refresh-models-btn" type="button" class="secondary-btn" title="Refresh Available Models">
                        üîÑ Refresh Models
                    </button>
                    <button id="test-ollama-btn" type="button" class="secondary-btn" title="Test Connection">
                        üîå Test Connection
                    </button>
                </div>
                
                <div id="available-models" class="model-list hidden">
                    <label>Available Models:</label>
                    <select id="model-select" size="4">
                        <!-- Models will be populated here -->
                    </select>
                    <small>Select a model or enter custom model name above</small>
                </div>
            </div>

            <div class="section">
                <h3>Local LLM Setup (Ollama)</h3>
                <p>To use local LLMs:</p>
                <ol>
                    <li>Install <a href="https://ollama.ai" target="_blank">Ollama</a></li>
                    <li>Run: <code>ollama pull llama2</code></li>
                    <li>Set CORS: <code>$env:OLLAMA_ORIGINS="*"</code> (Windows)</li>
                    <li>Start: <code>ollama serve</code></li>
                </ol>
                <p><strong>Note:</strong> The CORS environment variable is required for browser extensions.</p>
                <button id="test-connection" class="secondary-btn" title="Test Connection">üîó Test Connection</button>
            </div>

            <div class="button-group">
                <button id="save-settings" class="primary-btn" title="Save Settings">üíæ Save</button>
                <button id="reset-settings" class="secondary-btn" title="Reset">üîÑ Reset</button>
            </div>

            <div class="section">
                <h3>Debug Tools</h3>
                <button id="show-debug" class="secondary-btn" title="Show Debug Info">üêõ Debug</button>
                <div id="debug-info" class="debug-container hidden">
                    <textarea id="debug-output" rows="6" readonly placeholder="Debug information will appear here..."></textarea>
                    <button id="copy-debug" class="secondary-btn" title="Copy Debug Info">üìã Copy</button>
                </div>
            </div>

            <div class="section">
                <h3>üìù Microsoft Word Integration</h3>
                <p>Enhanced proofreading for Microsoft Word documents:</p>
                <div class="feature-list">
                    <div class="feature-item">
                        <span class="feature-icon">‚úÖ</span>
                        <span>Track Changes compatibility</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">‚úÖ</span>
                        <span>Comment suggestions</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">‚úÖ</span>
                        <span>Office 365 web support</span>
                    </div>
                </div>
                <div class="button-group">
                    <button id="enable-word-mode" class="secondary-btn" title="Enable Word Mode">üîó Enable Word Mode</button>
                    <button id="stop-word-mode" class="stop-btn hidden" title="Stop Word Mode">üõë Stop Word Mode</button>
                </div>
                <small>Optimizes AI suggestions for Microsoft Word documents</small>
            </div>

            <div id="connection-status" class="status hidden"></div>
        </div>

        <div id="privacy-tab" class="tab-content">
            <div class="section">
                <h3>üîí Privacy Protection Status</h3>
                <div id="privacy-status" class="privacy-status">
                    <div class="status-item">
                        <span class="status-icon">üõ°Ô∏è</span>
                        <span class="status-text">Data Leakage Prevention: <strong id="leakage-status">Active</strong></span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">‚úã</span>
                        <span class="status-text">Explicit Consent Required: <strong id="consent-status">Enabled</strong></span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">üìù</span>
                        <span class="status-text">Audit Logging: <strong id="audit-status">Enabled</strong></span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üîß Privacy Controls</h3>
                
                <div class="privacy-control">
                    <label class="checkbox-label">
                        <input type="checkbox" id="enable-audit-logging">
                        <span class="checkmark"></span>
                        Enable Audit Logging
                    </label>
                    <small>Record all data sent to LLM providers for transparency</small>
                </div>

                <div class="privacy-control">
                    <label class="checkbox-label">
                        <input type="checkbox" id="strict-consent">
                        <span class="checkmark"></span>
                        Strict Consent Mode
                    </label>
                    <small>Require explicit user action before sending any data</small>
                </div>

                <div class="privacy-control">
                    <label class="checkbox-label">
                        <input type="checkbox" id="provider-validation">
                        <span class="checkmark"></span>
                        Provider Validation
                    </label>
                    <small>Prevent data leakage to non-selected models</small>
                </div>
            </div>

            <div class="section">
                <h3>üìä Audit Log</h3>
                <div class="audit-controls">
                    <div class="button-group">
                        <button id="view-audit-log" class="secondary-btn" title="View Audit Log">üìã View Log</button>
                        <button id="export-audit-log" class="secondary-btn" title="Export Log">üíæ Export</button>
                        <button id="clear-audit-log" class="danger-btn" title="Clear Log">üóëÔ∏è Clear</button>
                    </div>
                </div>
                
                <div id="audit-log-container" class="audit-log-container hidden">
                    <div class="audit-log-header">
                        <span>Recent Data Transmissions</span>
                        <span id="audit-count" class="audit-count">0 entries</span>
                    </div>
                    <div id="audit-log-content" class="audit-log-content">
                        <div class="audit-empty">No audit entries yet</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>üîê Data Protection Info</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <h4>Local Processing</h4>
                        <p>When using local LLM providers (Ollama), your data never leaves your computer.</p>
                    </div>
                    <div class="info-item">
                        <h4>Explicit Consent</h4>
                        <p>Data is only sent to LLM providers when you explicitly click action buttons.</p>
                    </div>
                    <div class="info-item">
                        <h4>Audit Trail</h4>
                        <p>Complete log of all data transmissions with timestamps and provider details.</p>
                    </div>
                    <div class="info-item">
                        <h4>Provider Isolation</h4>
                        <p>Validation ensures data only goes to your selected LLM provider.</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="button-group">
                    <button id="save-privacy-settings" class="primary-btn" title="Save Privacy Settings">üíæ Save Privacy Settings</button>
                    <button id="reset-privacy-settings" class="secondary-btn" title="Reset to Defaults">üîÑ Reset</button>
                </div>
            </div>
        </div>

        <footer>
            <p>Select text on any webpage and right-click for AI proofreading</p>
        </footer>
    </div>

    <!-- OpenAI Guided Setup Modal -->
    <div id="openai-setup-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üöÄ Connect to OpenAI</h2>
                <button id="close-setup-modal" class="close-btn">√ó</button>
            </div>
            
            <div class="modal-body">
                <div id="setup-step-1" class="setup-step active">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <h3>Get Your OpenAI API Key</h3>
                    </div>
                    <p>We'll help you get an API key from OpenAI to use GPT models.</p>
                    <div class="step-content">
                        <div class="info-card">
                            <h4>üìã What you'll need:</h4>
                            <ul>
                                <li>An OpenAI account (free to create)</li>
                                <li>A payment method (API usage is pay-per-use)</li>
                                <li>2-3 minutes to complete setup</li>
                            </ul>
                        </div>
                        <div class="button-group">
                            <button id="open-openai-platform" class="primary-btn">
                                üåê Open OpenAI Platform
                            </button>
                            <button id="skip-to-manual" class="secondary-btn">
                                ‚öôÔ∏è Manual Setup
                            </button>
                        </div>
                    </div>
                </div>

                <div id="setup-step-2" class="setup-step hidden">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <h3>Create API Key</h3>
                    </div>
                    <p>Follow these steps on the OpenAI platform:</p>
                    <div class="step-content">
                        <div class="instruction-list">
                            <div class="instruction-item">
                                <div class="instruction-number">1</div>
                                <div class="instruction-text">
                                    <strong>Sign in or create account</strong><br>
                                    Go to <a href="https://platform.openai.com" target="_blank">platform.openai.com</a>
                                </div>
                            </div>
                            <div class="instruction-item">
                                <div class="instruction-number">2</div>
                                <div class="instruction-text">
                                    <strong>Navigate to API Keys</strong><br>
                                    Click your profile ‚Üí "View API keys" or go to API keys section
                                </div>
                            </div>
                            <div class="instruction-item">
                                <div class="instruction-number">3</div>
                                <div class="instruction-text">
                                    <strong>Create new key</strong><br>
                                    Click "Create new secret key" and give it a name like "AI Proofreader"
                                </div>
                            </div>
                            <div class="instruction-item">
                                <div class="instruction-number">4</div>
                                <div class="instruction-text">
                                    <strong>Copy the key</strong><br>
                                    Copy the API key (starts with "sk-proj-...")
                                </div>
                            </div>
                        </div>
                        <div class="button-group">
                            <button id="next-to-step-3" class="primary-btn">
                                ‚úÖ I have my API key
                            </button>
                            <button id="back-to-step-1" class="secondary-btn">
                                ‚Üê Back
                            </button>
                        </div>
                    </div>
                </div>

                <div id="setup-step-3" class="setup-step hidden">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <h3>Configure Extension</h3>
                    </div>
                    <p>Paste your API key below and we'll test the connection:</p>
                    <div class="step-content">
                        <div class="input-group">
                            <label for="setup-api-key">OpenAI API Key:</label>
                            <input type="password" id="setup-api-key" placeholder="sk-proj-..." autocomplete="off">
                            <button id="setup-validate-key" class="secondary-btn">
                                üîç Validate
                            </button>
                        </div>
                        
                        <div id="setup-validation-result" class="validation-result hidden">
                            <div id="setup-validation-status"></div>
                            <div id="setup-models-selection" class="hidden">
                                <label>Select preferred model:</label>
                                <select id="setup-model-select">
                                    <option value="">Loading models...</option>
                                </select>
                            </div>
                        </div>

                        <div class="button-group">
                            <button id="complete-setup" class="primary-btn disabled">
                                üéâ Complete Setup
                            </button>
                            <button id="back-to-step-2" class="secondary-btn">
                                ‚Üê Back
                            </button>
                        </div>
                    </div>
                </div>

                <div id="setup-step-4" class="setup-step hidden">
                    <div class="step-header">
                        <div class="step-number">‚úÖ</div>
                        <h3>Setup Complete!</h3>
                    </div>
                    <div class="step-content">
                        <div class="success-card">
                            <div class="success-icon">üéâ</div>
                            <h4>You're all set!</h4>
                            <p>Your OpenAI integration is configured and ready to use.</p>
                            <div id="setup-summary">
                                <!-- Dynamic content will be added here -->
                            </div>
                        </div>
                        <div class="button-group">
                            <button id="finish-setup" class="primary-btn">
                                üöÄ Start Proofreading
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../shared/browser-api.js"></script>
    <script src="popup.js"></script>
</body>
</html>
